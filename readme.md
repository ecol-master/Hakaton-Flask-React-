# Документация проекта (team - WhyNot)

## Разработчики
**[svetlanael12](https://github.com/svetlanael12) & [ecol-master](https://github.com/ecol-master?tab=followers)**

## Необходимые компоненты для начала работы
* git (система контроля версий)
* python (яп - для бекенда)
* node (для работы с фронтендом на js)

## Шаги для запуска проекта
---
1) создать пустую папку и выполнить в ней следующие команды:
    ```
    git clone https://github.com/ecol-master/Hakaton-Flask-React-
    cd Hakaton-Flask-React-
    ```
    таким образом мы склонировали репозиторий с кодом на ваш компьютер и переместились в склонированную папку

    ### Все последующие команды будут выполняться из данной папки (чтобы в нее переместиться используйте вторую команду)

2) создадим папки для хранения базы данных проекта и сохранения xls-файлов (выполнив команду cd Hakaton-Flask-React-)
    ```
    mkdir db
    mkdir xls_data
    ```
3) установим все необходимые библиотеки для работы бекенда (python moduls)
    ```
    pip install -r requirements.txt
    ```

4) настроим node модули для работы фронтенда
    ```
    npm init -y
    npm i
    ```
    npm i - установка всех зависимостей из package.json

5) сгенерируем основной скрипт загружующий содержимое всех страниц
    ```
    npm run dev
    ```
    результыт выполнение - скрипт main.js в папке static/scripts

6) запуск сервера на python 
    ```
    python main.py
    ```

    После запуска сервера в консоли выведется адрес на котором запустился сайт.

## Структура проекта
---

* main.py - файл запускающий сервер
* run_parser.py - файл запускающий парсер в атомовном режиме (чуть позже для парсера будет прописана отдельная инструкция)
* api - папка для регистрации запросов к собственному API для получения данных из базы данных
* data - файл с таблицами базы данных
* db - папка для хранения базы данных
* node_modules - папка в которые node.js сохраняет модули для работы
* parser - папка с парсерами
* src - папка с компонентами для отрисовки фронтенда (файлы javascript, css)
* static - папка в которую запишется main.js - главный скрипт,  отрисовывающий фронтенд
* templates - папка с html шаблонами, которые возращает flask при запросе определенного url
* xls_data - папка в которую сохранятся файлы xls с новостями
* .babelrc, .gitignore, package-lock.json, package.json, settings.py, webpack.config.js, requirements.txt - файлы настроек (фронтенда, бекенда, сохранения файлов и системы git)


## Парсер новостей
---
### Структура парсера
```
tools/
    __init__.py
    parser_fips.py
    parser_government.py
    parser_minprom.py
    parser_ural56.py

__init__.py
main_parser.py
parser_adaptive.py
parser_sites.py
```

**tools** - папка  с питоновскими файлами  (используются только для parser_sites.py), каждый из которых отвечает за парсинг отдельного источникаи запись полученных новостей в базу данных

**parser_sites.py** - собирает все парсеры из tools и запускает работу каждого из них

**parser_adaptive.py** - файл запускающий работу адаптивного парсера (планируется в будущем)

**main_parser.py** - запускающий работу адаптивного парсера и парсера сайтов 

#### **На вехнем уровне программы (папки Hakaton-Flask-React-) предложен файл run_parser.py который запускает работу main_parser по расписанию.** 
#### **Для автономной работы парсинга по расписанию нужно запускать именно этот парсер т.к работа сервера flask и библиотеки отвечающей за работу по расписанию невозможна.** 
#### **Для этого в веб интерфейсе на каждой странице предложена кнопка "*Обновить парсер*" для запуска парсера в любую минуту.**


## Возможные ошибки
* если ошибка возникла в одном из модулей парсера (в одном из файлов лежащих в папке tools из папки parser), то следует попробовать изменить значени ключа user-agent в словере headers. 

    Значение нужного ключа user-agent можно посмотреть следующим образом:
    1) перейдя на любую страницу в инетрнете 
    2) вызвать сочетание клавиш (Fn + F12 или F12)
    3) открыть вкладку Networks 
    4) перейти на любой запрос из списка
    5) открыть вкладку Headers  далее -> Headers Request - и найти значение ключа user-agent

* не стоит несколько раз подряд нажимаь на кнопку обновления данных в веб-интерфейсе, т.к парсер работает в течениии нескольких минут и может возникнуть большая нагрузка 

* (предупреждение) файлы формата xls записываеются в папку xls_data по следующему шаблону новости_(день)_(месяц)_(год) и при запуске функции сохранения обосновывающий документов несоклько раз за день содержимое файла будет перезаписываться.


